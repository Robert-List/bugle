#!/usr/bin/env python
import sys
import re

def expand_ac_var_repl(raw_vars, matchobj):
    return expand_ac_var(raw_vars, matchobj.group(1))

def expand_ac_var(raw_vars, name):
    if name not in raw_vars:
        print >>sys.stderr, 'Please add ' + name + ' to SConstruct.in'
        Exit(1)
    raw = raw_vars[name]
    repl = lambda matchobj: expand_ac_var_repl(raw_vars, matchobj)
    return re.sub(r'\$\{([-A-Za-z0-9_]+)\}', repl, raw)

sys.path.append('@srcdir@/site_scons')

ac_raw_vars = {
        'prefix': '''@prefix@''',
        'exec_prefix': '''@exec_prefix@''',
        'srcdir': '''@srcdir@''',
        'libdir': '''@libdir@''',
        'pkglibdir': '''@libdir@/@PACKAGE@''',
        'PACKAGE': '''@PACKAGE@'''
        }
ac_vars = dict([(key, expand_ac_var(ac_raw_vars, key)) for key in ac_raw_vars])
srcdir = Dir(ac_vars['srcdir'])
builddir = Dir('.')

Export('ac_vars', 'srcdir', 'builddir')

SConscript(srcdir.File('SConscript'), variant_dir = builddir, duplicate = 0)
